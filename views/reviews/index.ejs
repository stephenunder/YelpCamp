<% include ../partials/header %>
  <div class="row justify-content-center">
    <div class="col-md-12">
      <h1>Review Page: <%= campground.name %></h1>
      <a href="/campgrounds/<%= campground._id %>">Go back to the campground page</a>
      <div class="thumbnail">
        <div class="caption-full">
          <% if (campground.rating === 0) { %>
            <h5>
              <em>No reviews yet.</em>
            </h5>
          <% } else { %>
            <p>
              <span class="fas fa-star checked"></span>
              <span class="fas fa-star <% if (campground.rating > 1.5) { %> checked <% } %>"></span>
              <span class="fas fa-star <% if (campground.rating > 2.5) { %> checked <% } %>"></span>
              <span class="fas fa-star <% if (campground.rating > 3.5) { %> checked <% } %>"></span>
              <span class="fas fa-star <% if (campground.rating > 4.5) { %> checked <% } %>"></span>
              <em>(total reviews: <%= campground.reviews.length %>)</em>
            </p>
            <p>
              Current campground rating: <strong><%= campground.rating.toFixed(2) %></strong>
            </p>
            <p><h4>All reviews for this campground:</h4></p>
            <hr style="margin-top: 0;" />

            <% campground.reviews.forEach(function(review) { %>
              <div class="row">
                <div class="col-md-3">
                  <%- '<span class="fas fa-star checked"></span>'.repeat(review.rating) %><%- '<span class="fas fa-star"></span>'.repeat(5 - review.rating) %>
                  <div>Review by: <strong><%= review.author.username %></strong></div>
                  <span><em><%= review.updatedAt.toDateString() %></em></span>
                </div>
                <div class="col-md-9">
                  <p style="text-align: justify; word-wrap: break-word;">
                    <%= review.text %>
                  </p>
                  <% if (currentUser && review.author.id.equals(currentUser._id)) { %>
                    <a href="/campgrounds/<%= campground._id %>/reviews/<%= review._id %>/edit" class="btn btn-sm btn-warning">Edit</a>
                    <form id="delete-form" action="/campgrounds/<%= campground._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
                      <button class="btn btn-sm btn-danger">Delete</button>
                    </form>
                  <% } %>
                </div>
              </div>
              <hr />
            <% }) %>
          <% } %>
          <div>
            <a href="/campgrounds/<%= campground._id %>/reviews/new" class="btn btn-primary <% if (currentUser && campground.reviews.some(function (review) {return review.author.id.equals(currentUser._id)})) { %> disabled <% } %>">Write a New Review</a>
          </div>
          <div class="mt-2">
            <a href="/campgrounds/<%= campground._id %>" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Go Back</a>
          </div>
        </div>
      </div>
    </div>
  </div>
<% include ../partials/footer %>